
[
  
{
  
  
"response": 
[
  
  
  
{
  
  
  
  
"type": 
"text",
  
  
  
  
"text": 
"{\"pageContent\":\"{\\r\\n  \\\"case_id\\\": \\\"CASE-001\\\",\\r\\n  \\\"summary\\\": [\\r\\n    {\\r\\n      \\\"segment\\\": \\\"Сообщения 1–5\\\",\\r\\n      \\\"discussion\\\": [\\r\\n        {\\r\\n          \\\"quote\\\": \\\"Подтвердите freshness #5, пожалуйста.\\\",\\r\\n          \\\"operator_id\\\": \\\"operator_1\\\"\\r\\n        },\\r\\n        {\\r\\n          \\\"quote\\\": \\\"Передали данные по batch_code #456 другому оператору.\\\",\\r\\n          \\\"operator_id\\\": \\\"operator_2\\\"\\r\\n        }\\r\\n      ],\\r\\n      \\\"conclusion\\\": \\\"Была согласована передача CDM #5, другой оператор получил данные batch_code #456.\\\"\\r\\n    },\\r\\n    {\\r\\n      \\\"segment\\\": \\\"Сообщения 6–10\\\",\\r\\n      \\\"discussion\\\": [\\r\\n        {\\r\\n          \\\"quote\\\": \\\"Получили подтверждение по CDM 12383.\\\",\\r\\n          \\\"operator_id\\\": \\\"operator_1\\\"\\r\\n        }\\r\\n      ],\\r\\n      \\\"conclusion\\\": \\\"Подтверждена корректность CDM 12383, дальнейших действий пока не требуется.\\\"\\r\\n    }\\r\\n  ],\\r\\n  \\\"overall_conclusion\\\": \\\"Переписка завершена с подтверждением передачи части CDM и получением подтверждения по другим. Нет незавершённых вопросов, основанных на имеющихся данных.\\\"\\r\\n}\",\"metadata\":{\"loc\":{\"lines\":{\"to\":30,\"from\":1}},\"line\":1,\"source\":\"blob\",\"blobType\":\"application/json\"},\"id\":\"26314e8e-b3a0-4941-8a90-7c4b69d79f1a\"}"
  
  
  
},
  
  
  
{
  
  
  
  
"type": 
"text",
  
  
  
  
"text": 
"{\"pageContent\":\"},\\r\\n  \\\"execution_notes\\\": {\\r\\n    \\\"reason_detection\\\": \\\"Для выявления причины изменения статуса можно использовать ключевые слова: подтверждено, ожидает, исправлено, ошибка.\\\",\\r\\n    \\\"handoff\\\": \\\"Смена оператора фиксируется, если operator_id в следующем сообщении отличается от текущего.\\\"\\r\\n  }\\r\\n}\",\"metadata\":{\"loc\":{\"lines\":{\"to\":57,\"from\":52}},\"line\":1,\"source\":\"blob\",\"blobType\":\"application/json\"},\"id\":\"f3165d4b-e3cb-4520-8350-b95f8a0a7102\"}"
  
  
  
},
  
{
  
  
  
  
"type": 
"text",
  
  
  
  
"text": 
"{\"pageContent\":\"\\\"2_check_usage\\\": \\\"WITH keys AS (SELECT unnest(:cdm_keys::text[]) AS key_name),\\\\nmessages_filtered AS (\\\\n  SELECT {{message_content_field}} AS content, {{operator_field}} AS operator_id, created_at\\\\n  FROM {{messages_table}}\\\\n  WHERE (:from IS NULL OR created_at >= :from)\\\\n    AND (:to IS NULL OR created_at <= :to)\\\\n)\\\\nSELECT\\\\n  k.key_name,\\\\n  CASE WHEN EXISTS(SELECT 1 FROM messages_filtered m WHERE m.content ~* ('CDM[_ ]?ID?[:=]? *' || k.key_name) AND m.operator_id = :current_operator_id) THEN true ELSE false END AS used_by_us,\\\\n  CASE WHEN EXISTS(SELECT 1 FROM messages_filtered m WHERE m.content ~* ('CDM[_ ]?ID?[:=]? *' || k.key_name) AND m.operator_id != :current_operator_id) THEN true ELSE false END AS used_by_other_operators,\\\\n  CASE WHEN NOT EXISTS(SELECT 1 FROM messages_filtered m WHERE m.content ~* ('CDM[_ ]?ID?[:=]? *' || k.key_name) AND m.operator_id = :current_operator_id) THEN true ELSE false END AS not_transferred_by_us,\\\\n\",\"metadata\":{\"loc\":{\"lines\":{\"to\":26,\"from\":26}},\"line\":1,\"source\":\"blob\",\"blobType\":\"application/json\"},\"id\":\"6d70c8f7-477d-484d-9df7-b171ad207d72\"}"
  
  
  
},
  
  
  
{
  
  
  
  
"type": 
"text",
  
  
  
  
"text": 
"{\"pageContent\":\"{\\r\\n  \\\"id\\\": \\\"rule-cdm-usage-transfer-v4\\\",\\r\\n  \\\"name\\\": \\\"Анализ использования и передачи CDM для пары объектов\\\",\\r\\n  \\\"description\\\": \\\"Для двух объектов: находит все CDM и проверяет, какие использовались/передавались нами, какие мы не передали, и какие передавал другой оператор другой компании. Поддерживает поиск по CDM, CDM_id, CDM_ID=1234 и их вариациям.\\\",\\r\\n  \\\"inputs\\\": {\\r\\n    \\\"object_a_id\\\": { \\\"type\\\": \\\"string\\\", \\\"required\\\": true },\\r\\n    \\\"object_b_id\\\": { \\\"type\\\": \\\"string\\\", \\\"required\\\": true },\\r\\n    \\\"cdm_table\\\": { \\\"type\\\": \\\"string\\\", \\\"default\\\": \\\"cdm\\\" },\\r\\n    \\\"cdm_key_field\\\": { \\\"type\\\": \\\"string\\\", \\\"default\\\": \\\"key_name\\\" },\\r\\n    \\\"cdm_object_field\\\": { \\\"type\\\": \\\"string\\\", \\\"default\\\": \\\"object_id\\\" },\\r\\n    \\\"messages_table\\\": { \\\"type\\\": \\\"string\\\", \\\"default\\\": \\\"messages\\\" },\\r\\n    \\\"message_content_field\\\": { \\\"type\\\": \\\"string\\\", \\\"default\\\": \\\"content\\\" },\\r\\n    \\\"operator_field\\\": { \\\"type\\\": \\\"string\\\", \\\"default\\\": \\\"operator_id\\\" },\\r\\n    \\\"current_operator_id\\\": { \\\"type\\\": \\\"string\\\", \\\"required\\\": true },\",\"metadata\":{\"loc\":{\"lines\":{\"to\":14,\"from\":1}},\"line\":1,\"source\":\"blob\",\"blobType\":\"application/json\"},\"id\":\"713b6e5d-583a-4c92-92d9-70685d2a2bc6\"}"
  
  
  
},
 
{
  
  
  
  
"type": 
"text",
  
  
  
  
"text": 
"{\"pageContent\":\"{\\r\\n  \\\"case_id\\\": \\\"CASE-001\\\",\\r\\n  \\\"analysis\\\": {\\r\\n    \\\"expected\\\": [\\r\\n      \\\"Подтвердить freshness #5\\\",\\r\\n      \\\"Отправить фото CDM_ID=12384\\\"\\r\\n    ],\\r\\n    \\\"transferred\\\": [\\r\\n      \\\"Передали оператору другой компании данные по batch_code #456\\\",\\r\\n      \\\"Отправили отчёт о serial_no\\\"\\r\\n    ],\\r\\n    \\\"received\\\": [\\r\\n      \\\"Получили подтверждение по CDM 12383\\\",\\r\\n      \\\"Данные по warranty_id получены\\\"\\r\\n    ],\\r\\n    \\\"desired\\\": [\\r\\n      \\\"Желательно получить скан накладной по CDM_ID 12385\\\",\\r\\n      \\\"Запросить фото упаковки\\\"\\r\\n    ],\\r\\n    \\\"next_steps\\\": [\\r\\n      \\\"Проверить свежесть оставшихся CDM перед передачей следующему оператору\\\",\\r\\n      \\\"Собрать недостающие фотографии и добавить их в систему\\\",\\r\\n      \\\"Направить уточняющий вопрос по batch_code #456 оператору другой компании\\\"\\r\\n    ]\\r\\n  }\\r\\n}\",\"metadata\":{\"loc\":{\"lines\":{\"to\":26,\"from\":1}},\"line\":1,\"source\":\"blob\",\"blobType\":\"application/json\"},\"id\":\"13b4c356-9e6e-4d46-8083-30f42e313f5d\"}"
  
  
  
},
  
  
  
{
  
  
  
  
"type": 
"text",
  
  
  
  
"text": 
"{\"pageContent\":\"}\\r\\n  },\\r\\n  \\\"output_schema\\\": {\\r\\n    \\\"type\\\": \\\"object\\\",\\r\\n    \\\"properties\\\": {\\r\\n      \\\"object_a_id\\\": { \\\"type\\\": \\\"string\\\" },\\r\\n      \\\"object_b_id\\\": { \\\"type\\\": \\\"string\\\" },\\r\\n      \\\"cdm_keys\\\": { \\\"type\\\": \\\"array\\\", \\\"items\\\": { \\\"type\\\": \\\"string\\\" } },\\r\\n      \\\"used\\\": {\\r\\n        \\\"type\\\": \\\"array\\\",\\r\\n        \\\"items\\\": {\\r\\n          \\\"type\\\": \\\"object\\\",\\r\\n          \\\"properties\\\": {\\r\\n            \\\"key_name\\\": { \\\"type\\\": \\\"string\\\" },\\r\\n            \\\"used_by_us\\\": { \\\"type\\\": \\\"boolean\\\" },\\r\\n            \\\"used_by_other_operators\\\": { \\\"type\\\": \\\"boolean\\\" },\\r\\n            \\\"not_transferred_by_us\\\": { \\\"type\\\": \\\"boolean\\\" },\\r\\n            \\\"occurrences\\\": {\\r\\n              \\\"type\\\": \\\"array\\\",\\r\\n              \\\"items\\\": {\\r\\n                \\\"type\\\": \\\"object\\\",\\r\\n                \\\"properties\\\": {\\r\\n                  \\\"operator_id\\\": { \\\"type\\\": \\\"string\\\" },\\r\\n                  \\\"snippet\\\": { \\\"type\\\": \\\"string\\\" },\\r\\n                  \\\"created_at\\\": { \\\"type\\\": \\\"string\\\", \\\"format\\\": \\\"date-time\\\" }\\r\\n                }\\r\\n              }\\r\\n            }\\r\\n          }\\r\\n        }\",\"metadata\":{\"loc\":{\"lines\":{\"to\":56,\"from\":27}},\"line\":1,\"source\":\"blob\",\"blobType\":\"application/json\"},\"id\":\"7837931d-cf9d-4a84-b3fa-44740f699f4d\"}"
  
  
  
},
 
"text": 
"{\"pageContent\":\"{\\r\\n  \\\"rule_id\\\": \\\"CDM_info_by_objects\\\",\\r\\n  \\\"description\\\": \\\"Получение информации о CDM на основе переписки между двумя объектами. Использовать письма из БД, искать по названию объектов.\\\",\\r\\n  \\\"data_source\\\": {\\r\\n    \\\"type\\\": \\\"database\\\",\\r\\n    \\\"table\\\": \\\"messages\\\",\\r\\n    \\\"columns\\\": [\\\"message_id\\\", \\\"created_at\\\", \\\"subject\\\", \\\"letter\\\", \\\"operator_id\\\"]\\r\\n  },\\r\\n  \\\"parameters\\\": {\\r\\n    \\\"objects\\\": [\\\"SATELLITE MOON\\\", \\\"MIA-X01\\\"]\\r\\n  },\\r\\n  \\\"logic\\\": [\\r\\n    \\\"Взять все письма из таблицы messages, где в тексте письма (letter) встречаются названия обоих объектов.\\\",\\r\\n    \\\"Для каждой найденной переписки извлечь все упоминания CDM (CDM_id, CDM, CDM number и т.д.)\\\",\\r\\n    \\\"Определить для каждого CDM, использовался ли он нашей компанией или другим оператором\\\",\\r\\n    \\\"Зафиксировать CDM, которые не были переданы\\\",\\r\\n    \\\"Составить список всех CDM для этой пары объектов с указанием: использован нашей компанией, использован другим оператором, не передан\\\"\\r\\n  ],\\r\\n  \\\"output\\\": {\\r\\n    \\\"fields\\\": [\\r\\n      \\\"CDM_id\\\",\",\"metadata\":{\"loc\":{\"lines\":{\"to\":21,\"from\":1}},\"line\":1,\"source\":\"blob\",\"blobType\":\"application/json\"},\"id\":\"7536e753-4f3a-4680-8792-8c5dc81a4c3d\"}"
  
  
  
}
  
  
]
  
}
]